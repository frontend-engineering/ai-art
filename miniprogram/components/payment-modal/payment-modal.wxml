<!-- 支付弹窗组件 -->
<view class="payment-modal {{visible ? 'show' : ''}}" catchtouchmove="preventBubble">
  <!-- 遮罩层 -->
  <view class="modal-mask" bindtap="handleClose"></view>
  
  <!-- 弹窗内容 -->
  <view class="modal-content">
    <!-- 顶部装饰条 -->
    <view class="top-decoration"></view>
    
    <!-- 顶部装饰元素 -->
    <view class="decor-left">🧧</view>
    <view class="decor-right">🧧</view>
    
    <view class="modal-body">
      <!-- 标题 -->
      <view class="modal-header">
        <text class="modal-title">🎊 选择套餐</text>
        <text class="modal-subtitle">解锁更多功能，获得更好体验</text>
      </view>
      
      <!-- 套餐列表 -->
      <view class="packages-list">
        <view 
          wx:for="{{packages}}" 
          wx:key="id"
          class="package-item {{selectedPackage === item.id ? 'selected' : ''}} {{item.id === 'free' ? 'free' : ''}} {{item.recommended ? 'premium' : ''}} {{item.id === 'free' && isFreeExhausted ? 'disabled' : ''}}"
          bindtap="selectPackage"
          data-id="{{item.id}}"
        >
          <!-- 推荐标签 -->
          <view wx:if="{{item.recommended}}" class="recommend-tag">🔥 85%选择</view>
          
          <view class="package-content">
            <view class="package-info">
              <text class="package-name">{{item.name}}</text>
              <view class="package-features">
                <text 
                  wx:for="{{item.features}}" 
                  wx:for-item="feature"
                  wx:key="*this"
                  class="feature-tag"
                >{{feature}}</text>
              </view>
            </view>
            <view class="package-price">
              <text class="price-text">{{item.price === 0 ? '免费' : '¥' + item.price}}</text>
            </view>
          </view>
        </view>
      </view>
      
      <!-- 错误提示 -->
      <view wx:if="{{error && paymentStatus === 'failed'}}" class="error-box">
        <text class="error-icon">⚠️</text>
        <text class="error-text">{{error}}</text>
      </view>
      
      <!-- 成功提示 -->
      <view wx:if="{{paymentStatus === 'success'}}" class="success-box">
        <text class="success-icon">✅</text>
        <text class="success-text">操作成功</text>
      </view>
      
      <!-- 支付按钮 -->
      <button 
        class="pay-btn {{isPaying || paymentStatus === 'success' ? 'disabled' : ''}} {{paymentStatus === 'failed' ? 'retry' : ''}} {{selectedPackage === 'free' ? 'free' : 'paid'}}"
        bindtap="{{paymentStatus === 'failed' ? 'handleRetry' : 'handlePay'}}"
        disabled="{{isPaying || paymentStatus === 'success'}}"
      >
        <view wx:if="{{paymentStatus === 'processing'}}" class="btn-loading">
          <view class="loading-spinner"></view>
          <text>处理中...</text>
        </view>
        <view wx:elif="{{paymentStatus === 'success'}}" class="btn-success">
          <text class="success-mark">✓</text>
          <text>成功</text>
        </view>
        <view wx:elif="{{paymentStatus === 'failed'}}" class="btn-retry">
          <text>重试</text>
        </view>
        <view wx:else class="btn-normal">
          <text>{{selectedPackage === 'free' ? '🎁 使用免费版' : '💳 立即支付'}}</text>
        </view>
      </button>
      
      <!-- 取消按钮 -->
      <button 
        wx:if="{{paymentStatus !== 'success'}}"
        class="cancel-btn"
        bindtap="handleClose"
        disabled="{{isPaying}}"
      >取消</button>
      
      <!-- 支付说明 -->
      <view class="payment-notice">
        <text>支付即表示同意《用户协议》和《隐私政策》</text>
        <text wx:if="{{orderId}}" class="order-id">订单号: {{orderId}}</text>
      </view>
      
      <!-- 安全标识 -->
      <view class="security-badge">
        <text class="lock-icon">🔒</text>
        <text class="security-text">微信支付安全加密</text>
      </view>
    </view>
    
    <!-- 底部装饰 -->
    <view class="bottom-decoration"></view>
  </view>
</view>
