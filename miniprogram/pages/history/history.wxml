<view class="history-page">
  <!-- æ ‡ç­¾é¡µ -->
  <view class="tabs-container">
    <scroll-view class="tabs-scroll" scroll-x>
      <view class="tabs">
        <view 
          wx:for="{{tabs}}" 
          wx:key="id"
          class="tab-item {{activeTab === item.id ? 'active' : ''}}"
          data-id="{{item.id}}"
          bindtap="onTabChange"
        >
          {{item.label}}
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- åŠ è½½ä¸­ -->
  <view wx:if="{{loading && items.length === 0}}" class="loading-container">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:if="{{isEmpty && !loading}}" class="empty-container">
    <view class="empty-icon">ğŸ“‹</view>
    <text class="empty-text">æš‚æ— å†å²è®°å½•</text>
  </view>

  <!-- å†å²è®°å½•åˆ—è¡¨ -->
  <scroll-view class="items-container" scroll-y>
    <view wx:for="{{items}}" wx:key="id" class="history-item">
      <!-- æ¨¡å¼æ ‡ç­¾ -->
      <view class="item-header">
        <view class="mode-badge {{item.mode}}">{{item.modeLabel}}</view>
        <text class="item-time">{{item.createdAtFormatted}}</text>
      </view>

      <!-- åŸå§‹å›¾ç‰‡ -->
      <view class="original-images">
        <view 
          wx:for="{{item.originalImages}}" 
          wx:key="*this"
          class="image-thumbnail"
          data-image="{{item}}"
          bindtap="onPreviewImage"
        >
          <image 
            src="{{item}}" 
            mode="aspectFill"
            class="thumbnail-img"
          />
        </view>
      </view>

      <!-- ç®­å¤´ -->
      <view class="arrow-container">
        <text class="arrow">â†’</text>
      </view>

      <!-- ç”Ÿæˆç»“æœ -->
      <view class="generated-image">
        <image 
          src="{{item.generatedImage}}" 
          mode="aspectFill"
          class="result-img"
          data-image="{{item.generatedImage}}"
          bindtap="onPreviewImage"
        />
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="item-actions">
        <button class="action-btn save-btn">ä¿å­˜</button>
        <button class="action-btn delete-btn" data-id="{{item.id}}" bindtap="onDeleteItem">åˆ é™¤</button>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤šæç¤º -->
    <view wx:if="{{!hasMore && items.length > 0}}" class="load-more-tip">
      <text>å·²åŠ è½½å…¨éƒ¨</text>
    </view>
  </scroll-view>

  <!-- å›¾ç‰‡é¢„è§ˆå¼¹çª— -->
  <view wx:if="{{previewVisible}}" class="preview-modal" bindtap="onClosePreview">
    <image src="{{previewImage}}" mode="aspectFit" class="preview-image" />
  </view>
</view>
