<!--
  è´ºå¡ç¼–è¾‘é¡µ - å¤ç”¨åŸç½‘é¡µ CardEditor æ ·å¼
  Requirements: 2.4, 13.1-13.5
-->
<view class="card-editor-page {{isElderMode ? 'elder-mode' : ''}}">
  <!-- å››è§’è£…é¥°èƒŒæ™¯ -->
  <corner-background />
  
  <!-- èƒŒæ™¯ -->
  <view class="editor-bg"></view>
  
  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <view class="nav-bar">
    <view class="back-btn" bindtap="goBack">
      <text class="back-icon">â€¹</text>
    </view>
    <text class="nav-title">åˆ¶ä½œæ‹œå¹´è´ºå¡</text>
    <view class="nav-placeholder"></view>
  </view>
  
  <!-- ä¸»å†…å®¹åŒº -->
  <scroll-view class="editor-content" scroll-y>
    <!-- é¢„è§ˆåŒºåŸŸ -->
    <view class="preview-section">
      <view class="preview-card">
        <!-- èƒŒæ™¯å›¾ -->
        <image 
          class="card-bg" 
          src="{{selectedTemplate.url}}" 
          mode="aspectFill"
          wx:if="{{selectedTemplate}}"
        />
        
        <!-- ç”¨æˆ·ç…§ç‰‡ -->
        <view class="photo-area">
          <image 
            class="user-photo" 
            src="{{imageUrl}}" 
            mode="aspectFill"
            wx:if="{{imageUrl}}"
          />
          <view class="photo-placeholder" wx:else>
            <text class="placeholder-icon">ğŸ“·</text>
            <text class="placeholder-text">ç…§ç‰‡åŒºåŸŸ</text>
          </view>
        </view>
        
        <!-- ç¥ç¦è¯­ -->
        <view class="blessing-area {{selectedTemplate.textPosition}}">
          <text 
            class="blessing-text" 
            style="color: {{selectedTemplate.textColor || '#FFD700'}}"
          >{{blessing}}</text>
        </view>
      </view>
    </view>
    
    <!-- æ¨¡æ¿é€‰æ‹© -->
    <view class="section">
      <text class="section-title">é€‰æ‹©è´ºå¡æ¨¡æ¿</text>
      <scroll-view class="template-scroll" scroll-x enable-flex>
        <view class="template-list">
          <view 
            wx:for="{{templates}}" 
            wx:key="id"
            class="template-item {{selectedTemplate.id === item.id ? 'selected' : ''}}"
            bindtap="handleTemplateSelect"
            data-template="{{item}}"
          >
            <image class="template-thumb" src="{{item.url}}" mode="aspectFill" />
            <text class="template-name">{{item.name}}</text>
            <view class="check-mark" wx:if="{{selectedTemplate.id === item.id}}">
              <text class="check-icon">âœ“</text>
            </view>
          </view>
        </view>
      </scroll-view>
    </view>
    
    <!-- ç¥ç¦è¯­ç¼–è¾‘ -->
    <view class="section">
      <text class="section-title">ç¼–è¾‘ç¥ç¦è¯­</text>
      
      <!-- è¾“å…¥æ¡† -->
      <view class="input-wrapper">
        <textarea 
          class="blessing-input"
          value="{{blessing}}"
          placeholder="è¾“å…¥æ‚¨çš„ç¥ç¦è¯­..."
          maxlength="50"
          bindinput="handleBlessingInput"
        />
        <text class="char-count">{{blessing.length}}/50</text>
      </view>
      
      <!-- é¢„è®¾ç¥ç¦è¯­ -->
      <view class="preset-list">
        <view 
          wx:for="{{presetBlessings}}" 
          wx:key="index"
          class="preset-item {{blessing === item ? 'selected' : ''}}"
          bindtap="handleBlessingSelect"
          data-blessing="{{item}}"
        >
          <text class="preset-text">{{item}}</text>
        </view>
      </view>
    </view>
    
    <!-- æ“ä½œæŒ‰é’® -->
    <view class="action-section">
      <view class="preview-btn" bindtap="handlePreview">
        <text class="btn-icon">ğŸ‘ï¸</text>
        <text class="btn-text">é¢„è§ˆè´ºå¡</text>
      </view>
      
      <button class="share-btn" open-type="share">
        <text class="btn-icon">ğŸ“¤</text>
        <text class="btn-text">åˆ†äº«è´ºå¡</text>
      </button>
    </view>
  </scroll-view>
  
  <!-- é¢„è§ˆå¼¹çª— -->
  <view class="preview-modal {{showPreview ? 'show' : ''}}" catchtouchmove="preventMove">
    <view class="preview-mask" bindtap="closePreview"></view>
    <view class="preview-content">
      <!-- å…³é—­æŒ‰é’® -->
      <view class="close-btn" bindtap="closePreview">
        <text class="close-icon">Ã—</text>
      </view>
      
      <!-- è´ºå¡é¢„è§ˆ -->
      <view class="full-preview-card">
        <image 
          class="card-bg" 
          src="{{selectedTemplate.url}}" 
          mode="aspectFill"
          wx:if="{{selectedTemplate}}"
        />
        <view class="photo-area">
          <image 
            class="user-photo" 
            src="{{imageUrl}}" 
            mode="aspectFill"
            wx:if="{{imageUrl}}"
          />
        </view>
        <view class="blessing-area {{selectedTemplate.textPosition}}">
          <text 
            class="blessing-text" 
            style="color: {{selectedTemplate.textColor || '#FFD700'}}"
          >{{blessing}}</text>
        </view>
      </view>
      
      <!-- ä¿å­˜æŒ‰é’® -->
      <view 
        class="save-btn {{isSaving ? 'loading' : ''}}"
        bindtap="handleSave"
      >
        <text class="save-text">{{isSaving ? 'ä¿å­˜ä¸­...' : 'ä¿å­˜åˆ°ç›¸å†Œ'}}</text>
      </view>
    </view>
  </view>
</view>
