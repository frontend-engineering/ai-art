# 贺卡编辑器页面

## 功能概述

贺卡编辑器页面允许用户基于上传的照片制作个性化拜年贺卡，支持模板选择、祝福语编辑、实时预览和保存分享。

## 核心功能

### 1. 模板选择
- 提供 4 种贺卡模板（新春祝福、团圆美满、福气满满、恭贺新禧）
- 每个模板有独特的渐变背景色和装饰图案
- 支持横向滚动浏览和实时切换

### 2. 祝福语编辑
- 自定义输入祝福语（最多 50 字）
- 提供 5 条预设祝福语快速选择
- 实时字数统计

### 3. 贺卡生成
- 使用 Canvas 2D API 实时合成贺卡
- 自动绘制背景渐变、用户照片、装饰图案和祝福语
- 支持文字自动换行和阴影效果

### 4. 预览与保存
- 全屏预览生成的贺卡
- 一键保存到相册（需授权）
- 自动保存记录到后端数据库

### 5. 分享功能
- 支持分享给微信好友
- 支持分享到朋友圈
- 自动使用生成的贺卡作为分享图

## 技术实现

### Canvas 绘制流程
1. **背景绘制**：解析模板渐变色，创建线性渐变背景
2. **照片绘制**：居中绘制用户照片，添加白色边框
3. **装饰绘制**：随机生成半透明圆形装饰元素
4. **文字绘制**：绘制祝福语，支持自动换行和阴影

### 数据流
```
用户输入 → 选择模板 → 编辑祝福语 → 预览（Canvas生成）→ 保存到相册 + 后端
```

## 页面参数

| 参数 | 类型 | 说明 |
|------|------|------|
| image | string | 用户照片 URL（URL 编码） |

## API 调用

- `POST /api/greeting-card` - 保存贺卡记录
- `GET /api/greeting-card/user/:userId` - 获取用户贺卡列表

## 老年模式适配

- 字体放大：标题、祝福语、按钮文字
- 保持操作流程简单直观
- 大按钮设计，易于点击

## 使用示例

```javascript
// 从其他页面跳转
wx.navigateTo({
  url: `/pages/card-editor/card-editor?image=${encodeURIComponent(imageUrl)}`
});
```

## 测试指南

### 测试场景

#### 场景 1：正常流程
1. 从其他页面传入图片 URL 参数
2. 选择不同的贺卡模板
3. 编辑祝福语（输入或选择预设）
4. 点击"预览贺卡"查看效果
5. 点击"保存到相册"保存

#### 场景 2：边界测试
- 祝福语输入 50 字上限
- 无图片参数时显示占位符
- 未选择模板时提示
- 未输入祝福语时提示

#### 场景 3：权限测试
- 首次保存时请求相册权限
- 拒绝权限后引导用户去设置

### 预期结果
✅ 模板切换流畅，实时更新预览  
✅ 祝福语编辑实时显示字数  
✅ Canvas 生成贺卡清晰完整  
✅ 保存到相册成功  
✅ 分享功能正常  

## 注意事项

1. 需要用户授权相册权限才能保存
2. Canvas 绘制为异步操作，需等待完成
3. 图片加载失败会显示占位符
4. 后端保存失败不影响本地保存功能

## 性能指标

- Canvas 生成时间：< 2 秒
- 保存到相册：< 1 秒
- 页面加载时间：< 500ms
