<!--
  å¯Œè´µå˜èº«æ¨¡å¼æ¨¡æ¿é€‰æ‹©é¡µ - å¤ç”¨åŸç½‘é¡µ TemplateSelector æ ·å¼
  Requirements: 2.3
-->
<view class="template-page page-with-nav {{isElderMode ? 'elder-mode' : ''}}">
  <!-- å››è§’è£…é¥°èƒŒæ™¯ -->
  <corner-background />
  
  <!-- èƒŒæ™¯ -->
  <view class="template-bg"></view>
  
  <!-- å¤§å°å­—åˆ‡æ¢æŒ‰é’®ï¼ˆå·¦ä¸Šè§’å›ºå®šä½ç½®ï¼‰ -->
  <view class="elder-mode-toggle-fixed">
    <elder-mode-toggle />
  </view>
  
  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <view class="nav-bar">
    <view class="nav-left">
      <view class="back-btn" bindtap="goBack">
        <text class="back-icon">â€¹</text>
      </view>
    </view>
    <text class="nav-title">é€‰æ‹©æ¨¡æ¿</text>
    <view class="nav-right"></view>
  </view>
  
  <!-- åˆ†ç±»æ ‡ç­¾æ  -->
  <scroll-view class="category-scroll" scroll-x enable-flex>
    <view class="category-list">
      <view 
        wx:for="{{categories}}" 
        wx:key="id"
        class="category-item {{selectedCategory === item.id ? 'active' : ''}}"
        bindtap="handleCategoryChange"
        data-id="{{item.id}}"
      >
        <text class="category-icon">{{item.icon}}</text>
        <text class="category-name">{{item.name}}</text>
      </view>
    </view>
  </scroll-view>
  
  <!-- æ¨¡æ¿ç½‘æ ¼ -->
  <scroll-view class="template-scroll" scroll-y>
    <view class="template-grid">
      <view 
        wx:for="{{filteredTemplates}}" 
        wx:key="id"
        class="template-item {{selectedTemplate.id === item.id ? 'selected' : ''}}"
        bindtap="handleTemplateSelect"
        data-template="{{item}}"
      >
        <!-- æ¨¡æ¿å›¾ç‰‡ -->
        <image 
          class="template-image" 
          src="{{item.url}}" 
          mode="aspectFill"
          lazy-load
        />
        
        <!-- é€‰ä¸­æ ‡è®° -->
        <view wx:if="{{selectedTemplate.id === item.id}}" class="check-mark">
          <text class="check-icon">âœ“</text>
        </view>
        
        <!-- é¢„è§ˆæŒ‰é’® -->
        <view 
          class="preview-btn" 
          catchtap="handlePreview"
          data-template="{{item}}"
        >
          <text class="preview-icon">ğŸ”</text>
        </view>
        
        <!-- æ¨¡æ¿åç§° -->
        <view class="template-info">
          <text class="template-name">{{item.name}}</text>
        </view>
        
        <!-- ä»˜è´¹æ ‡è®° -->
        <view wx:if="{{item.isPremium}}" class="premium-badge">
          <text class="premium-text">VIP</text>
        </view>
      </view>
    </view>
    
    <!-- æ— æ¨¡æ¿æç¤º -->
    <view wx:if="{{filteredTemplates.length === 0}}" class="empty-state">
      <text class="empty-icon">ğŸ¨</text>
      <text class="empty-text">è¯¥åˆ†ç±»æš‚æ— æ¨¡æ¿</text>
    </view>
  </scroll-view>
  
  <!-- åº•éƒ¨æ“ä½œåŒº -->
  <view class="bottom-action">
    <!-- å½“å‰é€‰ä¸­æç¤º -->
    <view wx:if="{{selectedTemplate}}" class="selected-tip">
      <text class="tip-label">å·²é€‰æ‹©ï¼š</text>
      <text class="tip-value">{{selectedTemplate.name}}</text>
    </view>
    
    <!-- ç”ŸæˆæŒ‰é’® -->
    <view 
      class="generate-btn {{selectedTemplate ? 'active' : 'disabled'}} {{isGenerating ? 'loading' : ''}}"
      bindtap="handleGenerate"
    >
      <view class="btn-inner">
        <text class="btn-icon" wx:if="{{!isGenerating}}">âœ¨</text>
        <loading wx:if="{{isGenerating}}" />
        <text class="btn-text">{{isGenerating ? 'ç”Ÿæˆä¸­...' : 'ç«‹å³ç”Ÿæˆ'}}</text>
      </view>
      <view class="btn-shine" wx:if="{{selectedTemplate && !isGenerating}}"></view>
    </view>
  </view>
  
  <!-- æ¨¡æ¿é¢„è§ˆå¼¹çª— -->
  <view class="preview-modal {{showPreview ? 'show' : ''}}" catchtouchmove="preventMove">
    <view class="preview-mask" bindtap="closePreview"></view>
    <view class="preview-content" wx:if="{{previewTemplate}}">
      <!-- å…³é—­æŒ‰é’® -->
      <view class="close-btn" bindtap="closePreview">
        <text class="close-icon">Ã—</text>
      </view>
      
      <!-- é¢„è§ˆå›¾ç‰‡ - æ”¯æŒç¼©æ”¾å’Œç§»åŠ¨ -->
      <movable-area class="preview-image-area">
        <movable-view 
          class="preview-image-movable"
          direction="all"
          scale
          scale-min="1"
          scale-max="3"
          scale-value="1"
        >
          <image 
            class="preview-image" 
            src="{{previewTemplate.url}}" 
            mode="widthFix"
          />
        </movable-view>
      </movable-area>
      
      <!-- åº•éƒ¨ä¿¡æ¯ -->
      <view class="preview-info">
        <text class="preview-name">{{previewTemplate.name}}</text>
        <text class="preview-desc">{{previewTemplate.description}}</text>
        <view class="select-btn" bindtap="selectFromPreview">
          <text class="select-text">âœ¨ é€‰æ‹©æ­¤æ¨¡æ¿</text>
        </view>
      </view>
    </view>
  </view>
</view>
