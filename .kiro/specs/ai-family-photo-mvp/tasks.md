# Implementation Plan: AI全家福·团圆照相馆 MVP

## Overview

本实现计划将PRD和设计文档中的功能需求转化为可执行的开发任务。采用增量开发策略,优先实现核心功能(4选1生成、支付系统、水印功能),然后逐步添加高级功能(微动态、实体产品对接)。

所有任务基于当前代码库进行增量开发,复用已有的前端框架、后端服务和火山引擎API集成。

## 产品设计核心原则

1. **全链路操作≤5步** - 从启动到获得成果不超过5个操作步骤
2. **老年友好设计** - 大按钮(≥48×48px)、语音引导、简化界面
3. **春节氛围贯穿** - 中国红(#D4302B)、金色(#D4AF37)、灯笼、福字等元素
4. **每步明确反馈** - 所有操作都有0.1-0.3s的视觉/触觉反馈
5. **无断点闭环** - 用户旅程完整，无死胡同

## Tasks

- [x] 1. 数据库设计与初始化
  - 创建MySQL数据库schema
  - 实现数据库连接池和ORM配置
  - 编写数据库迁移脚本
  - _Requirements: 5.4, 6.1, 6.2, 6.3_

- [ ]* 1.1 编写数据库schema单元测试
  - 测试表结构创建
  - 测试外键约束
  - _Requirements: 6.1_

- [x] 2. 用户鉴权系统实现
  - [x] 2.1 实现用户ID生成和存储逻辑
    - 前端: 生成UUID并存储到localStorage
    - 后端: 创建users表记录
    - _Requirements: 5.1_

  - [x] 2.2 实现用户会话管理
    - 前端: 读取localStorage中的用户ID
    - 后端: 根据用户ID查询用户信息
    - _Requirements: 5.2_

  - [ ]* 2.3 编写用户鉴权属性测试
    - **Property 9: 用户ID唯一性**
    - **Validates: Requirements 5.1**

  - [ ]* 2.4 编写用户数据关联属性测试
    - **Property 10: 用户数据关联一致性**
    - **Validates: Requirements 5.2**

- [x] 3. Python工具层实现
  - [x] 3.1 实现图片压缩脚本 (compress_image.py)
    - 使用Pillow压缩图片到2MB以内
    - 统一格式为PNG
    - _Requirements: 7.1_

  - [x] 3.2 实现人脸检测脚本 (check_face.py)
    - 使用OpenCV检测人脸
    - 最小人脸尺寸80x80,置信度阈值0.7
    - _Requirements: 7.2, 7.3, 7.4_

  - [x] 3.3 实现人脸提取脚本 (extract_faces.py)
    - 使用OpenCV和dlib提取人脸区域
    - 返回人脸图片和位置信息
    - _Requirements: 9.1_

  - [x] 3.4 实现水印添加脚本 (add_watermark.py)
    - 使用Pillow添加自定义水印
    - 水印包含二维码和文字
    - _Requirements: 3.1, 3.2_

  - [x] 3.5 实现订单Excel导出脚本 (export_orders_excel.py)
    - 使用openpyxl生成Excel文件
    - 包含所有订单必要信息
    - _Requirements: 8.4, 8.5_

  - [ ]* 3.6 编写图片压缩属性测试
    - **Property 14: 图片压缩一致性**
    - **Validates: Requirements 7.1**

  - [ ]* 3.7 编写人脸检测属性测试
    - **Property 15: 人脸检测准确性**
    - **Validates: Requirements 7.2, 7.3**

  - [ ]* 3.8 编写人脸提取属性测试
    - **Property 18: 人脸提取准确性**
    - **Validates: Requirements 9.1**

  - [ ]* 3.9 编写Python进程通信属性测试
    - **Property 16: Python进程通信一致性 (Round-trip)**
    - **Validates: Requirements 7.5**

- [x] 4. 画布定位功能实现
  - [x] 4.1 实现人脸提取API
    - 调用extract_faces.py提取人脸
    - 返回人脸图片和位置信息
    - _Requirements: 9.1_

  - [x] 4.2 实现CanvasPositioning组件
    - 展示背景模板和提取的人脸
    - 支持拖拽、缩放、旋转人脸
    - _Requirements: 9.2, 9.3_

  - [x] 4.3 实现辅助功能
    - 网格线显示
    - 对齐线和吸附功能
    - _Requirements: 9.4_

  - [x] 4.4 实现定位信息传递
    - 收集所有人脸的位置信息
    - 传递给AI生成接口
    - _Requirements: 9.5_

  - [ ]* 4.5 编写画布定位属性测试
    - **Property 19: 画布定位信息一致性**
    - **Validates: Requirements 9.3, 9.5**

- [x] 5. 4选1生成策略实现
  - [x] 5.1 更新后端API调用逻辑
    - 使用即梦AI的 `sequential_image_generation: auto` 参数
    - 设置 `max_images: 4`
    - 启用流式输出 `stream: true`
    - 支持传递画布定位信息 `face_positions`
    - _Requirements: 1.1, 9.5_

  - [x] 5.2 实现流式响应处理
    - 解析SSE流式响应
    - 实时更新生成进度
    - _Requirements: 1.1_

  - [x] 5.3 实现前端4宫格组件 (FourGridSelector)
    - 展示4张生成的图片
    - 支持点击选择
    - 高亮显示选中状态
    - _Requirements: 1.2, 1.3_

  - [x] 5.4 实现选择状态管理
    - 保存用户选中的图片
    - 启用保存和重生成按钮
    - _Requirements: 1.4_

  - [ ]* 5.5 编写4选1生成属性测试
    - **Property 1: 4选1批量生成一致性**
    - **Validates: Requirements 1.1**

  - [ ]* 5.6 编写4宫格展示属性测试
    - **Property 2: 4宫格展示完整性**
    - **Validates: Requirements 1.2, 1.3**

  - [ ]* 5.7 编写选择状态属性测试
    - **Property 3: 选择状态一致性**
    - **Validates: Requirements 1.4**

- [x] 6. Checkpoint - 确保画布定位和4选1功能正常工作
  - 测试人脸提取
  - 测试画布定位
  - 测试生成流程
  - 测试4宫格展示
  - 询问用户是否有问题

- [x] 7. 水印功能实现
  - [x] 7.1 更新API调用添加watermark参数
    - 免费用户: `watermark: true`
    - 付费用户: `watermark: false`
    - _Requirements: 3.1_

  - [x] 7.2 集成Python水印脚本
    - 调用add_watermark.py添加自定义水印
    - 仅对免费用户生成的图片添加
    - _Requirements: 3.1, 3.2_

  - [x] 7.3 实现付费解锁逻辑
    - 付费后重新生成无水印图片
    - 返回高清原图下载链接
    - _Requirements: 3.3_

  - [ ]* 7.4 编写水印添加属性测试
    - **Property 6: 水印添加一致性**
    - **Validates: Requirements 3.1, 3.2**

  - [ ]* 7.5 编写付费解锁属性测试
    - **Property 7: 付费解锁一致性**
    - **Validates: Requirements 3.3**

- [x] 8. 支付系统实现
  - [x] 8.1 创建支付订单API
    - 创建payment_orders表记录
    - 生成订单ID
    - _Requirements: 2.1, 2.2_

  - [x] 8.2 集成微信支付API
    - 调用微信JSAPI发起支付
    - 处理支付回调
    - 验证回调签名
    - _Requirements: 2.3_

  - [x] 8.3 实现支付状态更新
    - 更新订单状态
    - 更新用户付费状态
    - 解锁对应功能
    - _Requirements: 2.4_

  - [x] 8.4 实现支付失败处理
    - 展示错误提示
    - 允许重试
    - _Requirements: 2.5_

  - [x] 8.5 更新前端PaymentModal组件
    - 展示三种套餐(免费/9.9元/29.9元)
    - 调用支付API
    - 处理支付结果
    - _Requirements: 2.1, 2.2_

  - [ ]* 8.6 编写支付流程属性测试
    - **Property 5: 支付流程完整性**
    - **Validates: Requirements 2.3, 2.4**

  - [ ]* 8.7 编写权限控制属性测试
    - **Property 4: 权限控制一致性**
    - **Validates: Requirements 1.5, 4.4**

- [x] 9. Checkpoint - 确保支付功能正常工作
  - 测试支付流程
  - 测试权限控制
  - 测试水印功能
  - 询问用户是否有问题

- [-] 10. 数据持久化实现
  - [x] 10.1 实现生成历史保存
    - 保存任务ID、图片URL到generation_history表
    - 关联用户ID
    - _Requirements: 6.2_

  - [x] 10.2 实现支付记录保存
    - 保存订单信息到payment_orders表
    - 关联用户ID和生成记录ID
    - _Requirements: 6.3_

  - [x] 10.3 实现历史记录查询API
    - 查询用户最近10条记录
    - 按创建时间倒序排列
    - _Requirements: 6.5_

  - [x] 10.4 实现定时清理任务
    - 清理超过30天的未付费记录
    - 使用Node.js定时任务
    - _Requirements: 6.4_

  - [ ]* 10.5 编写数据持久化属性测试
    - **Property 12: 数据持久化一致性**
    - **Validates: Requirements 5.4, 6.2, 6.3**

  - [ ]* 10.6 编写历史记录查询属性测试
    - **Property 13: 历史记录查询一致性**
    - **Validates: Requirements 6.5**

- [ ] 11. 微动态生成实现
  - [x] 11.1 实现视频生成API调用
    - 调用火山引擎视频生成API
    - 配置参数(motion_bucket_id, fps等)
    - _Requirements: 4.1_

  - [x] 11.2 实现Live Photo格式转换
    - 使用FFmpeg转换MP4为MOV
    - HEVC编码
    - _Requirements: 4.3_

  - [x] 11.3 实现权限控制
    - 仅尊享包用户可使用
    - 其他用户提示升级
    - _Requirements: 4.4_

  - [x] 11.4 实现错误处理
    - 生成失败提示
    - 允许重试
    - _Requirements: 4.5_

  - [ ]* 11.5 编写微动态格式属性测试
    - **Property 8: 微动态格式完整性**
    - **Validates: Requirements 4.3**

- [x] 12. 实体产品对接实现 (MVP简化版)
  - [x] 12.1 实现产品推荐UI
    - 在结果页展示产品推荐
    - 展示晶瓷画和卷轴选项
    - _Requirements: 8.1_

  - [x] 12.2 实现产品预览功能
    - 展示照片在实体产品上的效果
    - _Requirements: 8.2_

  - [x] 12.3 实现订单收集功能
    - 收集用户收货信息和产品选择
    - 保存到product_orders表
    - _Requirements: 8.3_

  - [x] 12.4 实现Excel导出功能
    - 调用export_orders_excel.py生成Excel
    - 管理员可下载订单文件
    - _Requirements: 8.4, 8.5_

  - [ ]* 12.5 编写Excel导出属性测试
    - **Property 17: 实体产品订单Excel导出完整性**
    - **Validates: Requirements 8.4, 8.5**

- [ ] 13. 性能优化实现
  - [ ] 13.1 实现Redis缓存
    - 缓存模板列表
    - 缓存用户会话
    - _Requirements: 10.3_

  - [ ] 13.2 配置CDN加速
    - 配置腾讯云CDN
    - 加速图片加载
    - _Requirements: 10.4_

  - [ ] 13.3 实现弹性扩容配置
    - 配置阿里云ECS自动扩容
    - 设置CPU阈值80%
    - _Requirements: 10.5_

  - [ ]* 13.4 编写性能属性测试
    - **Property 20: 生成性能保证**
    - **Property 21: 并发性能保证**
    - **Property 22: 图片加载性能保证**
    - **Validates: Requirements 10.1, 10.2, 10.4**

- [ ] 14. 错误处理实现
  - [x] 14.1 实现API重试逻辑
    - 失败自动重试1次
    - 超时时间30秒
    - _Requirements: 11.1_

  - [x] 14.2 实现错误提示UI
    - 友好的错误信息
    - 提供解决方案建议
    - _Requirements: 11.2, 11.4_

  - [x] 14.3 实现错误日志记录
    - 记录错误码、错误信息、时间戳
    - 持久化到文件或数据库
    - _Requirements: 11.3_

  - [x] 14.4 实现参数校验
    - 生成和支付前校验参数
    - 无效参数返回400错误
    - _Requirements: 11.5_

  - [ ]* 14.5 编写错误处理属性测试
    - **Property 23: API重试一致性**
    - **Property 24: 错误处理一致性**
    - **Property 25: 错误日志完整性**
    - **Property 26: 参数校验一致性**
    - **Validates: Requirements 11.1, 11.2, 11.3, 11.4, 11.5**

- [x] 15. Final Checkpoint - 完整功能测试
  - 端到端测试完整流程
  - 性能测试
  - 安全测试
  - 询问用户是否准备上线

---

## 前端UI/UX完善任务 (基于frontend-PRD.md)

### 阶段一：启动-登录环节优化

- [x] 16. 启动页(LaunchScreen)实现
  - [x] 16.1 创建启动页组件
    - 3秒自动轮播3张情感图(留守儿童、视频通话、AI全家福成品)
    - 主标题"这个春节，让爱没有距离"
    - 副标题"3步生成惊艳全家的AI全家福"
    - 动态数字"已帮助X个家庭团圆"
    - 底部红色"立即制作"按钮(48×160px)
    - 右上角"跳过"文字按钮
    - _UI规范: 中国红#D4302B, 金色#D4AF37, 暖白背景#FFF8F0_

  - [x] 16.2 实现自动跳转逻辑
    - 3秒后自动跳转到功能选择页
    - 支持右上角"跳过"立即跳转
    - 首次访问显示，后续访问可选择性跳过

  - [x] 16.3 集成微信快捷登录
    - 跳转后自动触发微信授权
    - 1秒内完成登录
    - 自动获取微信昵称和头像
    - 无额外注册步骤

### 阶段二：功能选择环节实现

- [x] 17. 功能选择页(FunctionSelector)实现
  - [x] 17.1 创建功能选择页组件
    - 上下两个大卡片(各占50%屏幕高度)
    - **卡片A - 时空拼图**: 图标🧩, "家人天各一方？拼出大团圆"
    - **卡片B - 富贵变身**: 图标👑, "背景太土？一秒变豪门"
    - 示例图展示效果对比
    - 底部"有疑问？查看30秒教程"灰色文字链

  - [x] 17.2 实现卡片交互效果
    - 点击时0.1s缩放+红色边框高亮反馈
    - 跳转对应上传页面
    - 卡片hover时轻微阴影效果

  - [x] 17.3 实现教程视频弹窗
    - 点击底部文字链弹出短视频教程
    - 自动播放，支持关闭
    - 30秒快速演示完整流程

### 阶段三：图片上传环节优化

- [x] 18. 上传页面(UploadPage)重构
  - [x] 18.1 时空拼图上传模式
    - 2-5个圆形上传框(直径80px)
    - "+添加家人"占位图
    - 支持多选相册/拍照
    - 上传成功显示"✓ 人脸检测成功"
    - 缩略图右上角"×"删除按钮
    - 上传失败显示"⚠️ 人脸模糊/未检测到人脸"
    - 配示例图参考，引导重拍

  - [x] 18.2 富贵变身上传模式
    - 1个大尺寸上传框(280×200px)
    - 支持拖拽上传
    - 上传中显示进度条
    - 完成后显示"✓ 上传成功"
    - 提示"支持JPG/PNG，最大10MB"
    - 自动检测图片格式，不合格弹窗提示

  - [x] 18.3 语音指令支持
    - 支持语音指令"添加爸爸的照片"
    - 自动打开相册
    - 语音引导文案"请上传清晰正面照，光线越亮效果越好"

  - [x] 18.4 下一步按钮状态管理
    - 上传满2人后，底部"下一步"按钮点亮
    - 默认置灰状态
    - 蓝色渐变按钮(48×260px)

### 阶段四：模板选择环节实现

- [x] 19. 模板选择页(TemplateSelector)实现
  - [x] 19.1 创建模板选择组件
    - 横向滚动选择模板
    - 默认选中"新中式团圆"模板
    - 选中模板金色边框高亮+"✓"标记
    - 滚动时模板卡片顺滑过渡效果

  - [x] 19.2 实现模板数据管理
    - 从后端获取模板列表
    - 缓存模板数据
    - 支持模板预览大图

  - [x] 19.3 实现生成按钮
    - 底部"生成"按钮
    - 点击跳转等待页
    - 传递选中模板ID和上传图片

### 阶段五：生成等待环节优化

- [x] 20. 生成等待页(GeneratingPage)优化
  - [x] 20.1 实现动态进度展示
    - 旋转灯笼动画(80×80px)
    - 动态进度条
    - 文案同步更新:
      - 20%识别人脸
      - 40%调和光线
      - 60%融合背景
      - 80%优化细节
      - 100%完成

  - [x] 20.2 实现队列提示
    - 显示"您前面还有X位用户，预计等待X秒"
    - 底部"先看别人的作品"按钮
    - 点击跳转案例页

  - [x] 20.3 实现生成结果处理
    - 生成成功自动跳转结果筛选页
    - 失败弹窗提示"生成失败，点击重试"
    - 支持一键重试

### 阶段六：结果筛选环节实现

- [x] 21. 结果筛选页(ResultSelector)实现 - 已有FourGridSelector组件
  - [x] 21.1 优化4宫格展示效果
    - 采用"掀布"动效(从模糊到清晰)
    - 增强惊喜感
    - 图片加载动画

  - [x] 21.2 优化选择交互
    - 点击图片放大预览
    - 支持双指缩放
    - 选中后红色边框+"✓ 选中"标记
    - 仅选中1张后，"确认选择"按钮点亮

  - [x] 21.3 实现确认选择逻辑
    - 点击"确认选择"跳转成果页
    - 保存选中图片到历史记录

### 阶段七：成果页-增值操作环节优化

- [x] 22. 成果页(ResultPage)重构
  - [x] 22.1 实现高清图展示区
    - 顶部60%屏幕展示高清图
    - 左上角"Live"标识(微动态标识)
    - 红色印章水印"AI团圆照相馆"(带小程序码)
    - 水印不遮挡人脸
    - 高清图自动播放5秒微动态

  - [x] 22.2 实现功能按钮区
    - 垂直排列4个功能按钮(各48×48px)
    - 金色"下载高清图"按钮
    - 红色"生成拜年贺卡"按钮
    - 紫色"定制晶瓷画"按钮
    - 灰色"分享家族群"按钮
    - 所有按钮带图标+文字

  - [x] 22.3 实现下载高清图功能
    - 点击弹出付费弹窗
    - 选中套餐金色边框反馈
    - 点击支付触发微信支付
    - 支付成功后下载无水印高清图

  - [x] 22.4 实现生成贺卡功能
    - 跳转贺卡编辑页
    - 支持自定义祝福语
    - 实时预览效果
    - 支持保存和分享

  - [x] 22.5 实现定制晶瓷画功能
    - 跳转规格选择页
    - 选择后显示产品预览图
    - 集成实体产品订单系统

  - [x] 22.6 实现分享功能
    - 自动生成带小程序码的分享图
    - 添加春节文案
    - 直接跳转微信分享界面

  - [x] 22.7 实现长按保存功能
    - 长按可保存带水印预览图
    - 显示"保存成功"提示

### 阶段八：付费弹窗优化

- [x] 23. 付费弹窗(PaymentModal)优化 - 已有组件
  - [x] 23.1 优化弹窗样式
    - 圆角12px，白色背景
    - 红色边框顶部装饰
    - 弹出/关闭0.3s淡入淡出效果
    - 不可点击外部关闭
    - 底部"微信支付安全加密"信任标识

  - [x] 23.2 优化套餐卡片设计
    - 纵向排列3个套餐卡片
    - **免费版**: 0元，白色背景，"标清带水印，限2人合成"
    - **9.9元尝鲜包**: 红色背景，划掉原价19.9元，"高清无水印+3-5人合成+热门模板"
    - **29.9元尊享包**: 金色背景+"85%用户选择"标签，"4K原图+微动态+贺卡+全模板+优先队列"
    - 选中套餐金色边框反馈

  - [x] 23.3 实现支付流程优化
    - 点击支付按钮触发微信支付
    - 支付中显示加载动画
    - 支付成功显示"✓ 支付成功"
    - 支付失败显示"⚠️ 支付失败，请重试"

### 阶段九：老年友好专项设计

- [x] 24. 老年模式实现
  - [x] 24.1 实现老年模式开关
    - 首页右上角设置"老年模式"按钮
    - 带老人图标
    - 开启后字体+20%、按钮+15%

  - [x] 24.2 实现语音引导
    - 关键页面(上传、生成)自动播放语音提示
    - 支持"关闭语音"按钮
    - 语音文案通俗易懂

  - [x] 24.3 实现简化界面
    - 老年模式下隐藏非核心元素
    - 隐藏"看别人作品""教程"等
    - 仅保留核心操作按钮

### 阶段十：体验优化细节

- [x] 25. 惊喜感与氛围营造
  - [x] 25.1 实现烟花动画
    - 生成成功后屏幕绽放1秒烟花动画
    - 配"团圆成功"音效

  - [x] 25.2 实现节气文案
    - 根据日期自动切换页面顶部文案
    - 除夕"除夕团圆，万事顺遂"
    - 初一"新年快乐，阖家欢乐"
    - 元宵"元宵佳节，团团圆圆"

  - [x] 25.3 优化错误提示
    - 通俗化错误提示
    - 不说"参数错误"，说"照片里人脸太小啦，选一张正面大头像吧"
    - 所有错误提示配emoji和解决方案

  - [x] 25.4 实现背景音乐
    - 所有页面支持开启春节轻音乐
    - 默认关闭
    - 底部带"音乐"开关图标

### 阶段十一：UI组件规范统一

- [x] 26. 基础视觉规范统一
  - [x] 26.1 统一色调系统
    - 主色中国红(#D4302B)
    - 辅色金色(#D4AF37)
    - 背景暖白(#FFF8F0)
    - 所有页面应用统一色调

  - [x] 26.2 统一字体规范
    - 标题: 24-28px，汉仪尚巍手书
    - 正文: 18px，苹方/思源黑体
    - 说明文字: 16px，浅灰色
    - 老年模式: 所有字体放大20%

  - [x] 26.3 统一圆角与阴影
    - 所有按钮/卡片8px圆角
    - 卡片hover时轻微阴影
    - 统一阴影参数

  - [x] 26.4 统一节日元素
    - 全程穿插灯笼、烟花、福字、红绸元素
    - 不堆砌，适度装饰
    - 按钮边缘红绸装饰
    - 等待页旋转灯笼

- [x] 27. 交互组件规范统一
  - [x] 27.1 统一按钮设计
    - 所有可点击按钮≥48×48px
    - 点击时0.1s缩放(缩小10%)+背景色加深
    - 主要按钮: 红色渐变背景，白色粗体字
    - 次要按钮: 白色背景，红色边框+文字
    - 功能按钮: 对应功能色，带直观图标

  - [x] 27.2 统一弹窗设计
    - 圆角12px，白色背景
    - 红色边框顶部装饰
    - 弹出/关闭0.3s淡入淡出效果
    - 支持点击外部关闭(除付费弹窗)

  - [x] 27.3 统一加载与提示设计
    - 加载动画: 统一使用旋转灯笼动画(80×80px)
    - 成功提示: 绿色"✓"+ 黑色文字
    - 错误提示: 红色"⚠️"+ 红色文字
    - 引导提示: 蓝色"i"+ 黑色文字

### 阶段十二：路由与导航优化

- [x] 28. 路由系统完善
  - [x] 28.1 更新路由配置
    - / - 启动页(LaunchScreen)
    - /function-selector - 功能选择页
    - /upload - 上传页面
    - /template - 模板选择页
    - /generating - 生成等待页
    - /result-selector - 结果筛选页
    - /result - 成果页
    - /card-editor - 贺卡编辑页
    - /product-order - 产品订单页

  - [x] 28.2 实现页面转场动画
    - 所有页面切换使用淡入淡出效果
    - 0.3s过渡时间
    - 保持流畅体验

  - [x] 28.3 实现返回按钮
    - 所有子页面左上角返回按钮
    - 点击返回上一页
    - 保留页面状态

## Notes

- 标记 `*` 的任务为可选测试任务,可以跳过以加快MVP开发
- 每个任务都引用了具体的需求编号,确保可追溯性
- Checkpoint任务用于阶段性验证,确保增量开发质量
- 属性测试使用fast-check框架,每个测试至少运行100次迭代
- 单元测试使用Jest框架,覆盖核心业务逻辑

## 产品设计亮点总结

### 1. 情感化设计
- 启动页情感图轮播(留守儿童、视频通话、AI全家福)直击用户痛点
- "这个春节，让爱没有距离"情感共鸣文案
- 生成成功烟花动画+音效增强惊喜感

### 2. 降低决策成本
- 默认选中"新中式团圆"模板，减少选择困难
- 功能选择页仅2个大卡片，清晰明确
- 套餐设计中标注"85%用户选择"引导决策

### 3. 老年友好设计
- 大按钮(≥48×48px)易于点击
- 语音引导降低学习成本
- 老年模式字体+20%、按钮+15%
- 简化界面隐藏非核心功能

### 4. 即时反馈机制
- 所有操作0.1-0.3s视觉反馈
- 上传成功/失败即时提示
- 生成进度实时展示(20%→40%→60%→80%→100%)
- 支付成功/失败明确提示

### 5. 春节氛围营造
- 中国红(#D4302B)+金色(#D4AF37)主色调
- 灯笼、烟花、福字、红绸等节日元素
- 节气文案自动切换(除夕、初一、元宵)
- 春节轻音乐氛围营造

### 6. 无断点闭环设计
- 启动→功能选择→上传→模板→生成→筛选→成果→增值，全链路≤5步
- 每个环节都有明确的下一步引导
- 失败场景提供重试入口
- 历史记录支持继续支付/重新生成

### 7. 增值服务设计
- 免费版带水印，付费解锁高清
- 三档套餐满足不同需求(0元/9.9元/29.9元)
- 贺卡、晶瓷画、卷轴等实体产品增值
- 微动态(Live Photo)尊享包专属

## 开发优先级建议

### P0 - 核心流程(必须完成)
1. 启动页→功能选择→上传→生成→筛选→成果 完整流程
2. 支付系统集成
3. 水印功能
4. 基础UI规范统一

### P1 - 体验优化(强烈建议)
1. 老年模式
2. 语音引导
3. 动画效果(烟花、掀布、旋转灯笼)
4. 节日元素装饰

### P2 - 增值功能(可选)
1. 贺卡编辑
2. 实体产品订单
3. 微动态生成
4. 背景音乐

### P3 - 高级优化(后期迭代)
1. 性能优化(Redis缓存、CDN)
2. 弹性扩容
3. 完整的错误处理和日志
4. 属性测试覆盖

## 当前进度评估

### 已完成 ✅
- ✅ 数据库设计与初始化 (任务1)
- ✅ 用户鉴权系统 (任务2)
- ✅ Python工具层 (任务3: 压缩、人脸检测、水印、Excel导出)
- ✅ 画布定位功能 (任务4)
- ✅ 4选1生成策略 (任务5)
- ✅ 水印功能 (任务7)
- ✅ 支付系统 (任务8)
- ✅ 数据持久化 (任务10)
- ✅ 微动态生成 (任务11)
- ✅ 实体产品对接MVP (任务12)
- ✅ Checkpoint 6 & 9 完成

### 核心后端API已实现
后端已实现所有核心功能API端点，包括：
- 用户管理 (创建、查询、更新付费状态)
- 艺术照生成 (4选1策略、画布定位、流式查询)
- 人脸提取与水印添加
- 支付系统 (创建订单、微信支付、回调处理、状态查询)
- 历史记录管理
- 微动态视频生成与Live Photo转换
- 实体产品订单管理与Excel导出

### 待完成 🚧

#### 前端UI/UX实现 (任务16-28)
根据frontend-PRD.md，需要实现完整的用户交互流程：

**P0 - 核心流程页面** (必须完成):
- [-] 启动页 (LaunchScreen) - 任务16
- [-] 功能选择页 (FunctionSelector) - 任务17
- [-] 上传页面优化 (UploadPage) - 任务18
- [-] 模板选择页 (TemplateSelector) - 任务19
- [-] 生成等待页优化 (GeneratingPage) - 任务20
- [-] 结果筛选页优化 (ResultSelector) - 任务21
- [-] 成果页重构 (ResultPage) - 任务22

**P1 - 体验优化** (强烈建议):
- [-] 付费弹窗优化 - 任务23
- [ ] 老年模式实现 - 任务24
- [-] 惊喜感与氛围营造 - 任务25

**P2 - 规范统一** (可选):
- [-] UI组件规范统一 - 任务26-27
- [-] 路由与导航优化 - 任务28

#### 性能优化 (任务13)
- [ ] Redis缓存实现
- [ ] CDN加速配置
- [ ] 弹性扩容配置

#### 错误处理 (任务14)
- [-] API重试逻辑
- [-] 错误提示UI
- [-] 错误日志记录
- [-] 参数校验

#### 最终测试 (任务15)
- [-] 端到端测试
- [-] 性能测试
- [ ] 安全测试

### 建议执行顺序
1. **第一阶段**: 完成16-22任务(核心页面流程) - 预计3-5天
   - 优先实现完整的用户旅程：启动→选择→上传→模板→生成→筛选→成果
   - 确保与后端API正确对接
   
2. **第二阶段**: 完成23-25任务(付费弹窗、老年模式、体验优化) - 预计2-3天
   - 优化用户体验和转化率
   - 实现老年友好设计
   
3. **第三阶段**: 完成26-28任务(UI规范统一、路由优化) - 预计1-2天
   - 统一视觉规范
   - 优化页面转场
   
4. **第四阶段**: 完成13-14任务(性能优化、错误处理) - 预计2-3天
   - 提升系统稳定性
   - 完善错误处理
   
5. **第五阶段**: 完成15任务(最终测试) - 预计1-2天
   - 全面测试验收

**总预计开发时间**: 9-15天

### 关键注意事项
1. 后端API已完整实现，前端开发可直接对接
2. 所有Python工具脚本已就绪，包括人脸检测、水印、Excel导出等
3. 数据库schema已创建，支持用户、生成历史、支付订单、产品订单
4. 微信支付集成已完成，需配置正确的环境变量
5. 前端需要实现的主要是UI/UX层面的用户交互流程
